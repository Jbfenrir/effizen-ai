<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Manuel - Bug Changement Onglet</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .step { margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .step h3 { color: #2563eb; margin-top: 0; }
        .success { background: #f0f9ff; border-color: #38bdf8; }
        .warning { background: #fffbeb; border-color: #fbbf24; }
        .error { background: #fef2f2; border-color: #f87171; }
        .code { background: #f8f9fa; padding: 8px; border-radius: 4px; font-family: monospace; }
        .button { 
            display: inline-block; padding: 10px 20px; margin: 5px;
            background: #2563eb; color: white; text-decoration: none;
            border-radius: 6px; border: none; cursor: pointer;
        }
        .button:hover { background: #1d4ed8; }
    </style>
</head>
<body>
    <h1>üß™ Test Manuel - Correction Bug Changement d'Onglet</h1>
    
    <div class="step success">
        <h3>‚úÖ Corrections Appliqu√©es</h3>
        <ul>
            <li><strong>Singleton Global</strong> : Client Supabase unique attach√© √† window (survit au HMR)</li>
            <li><strong>D√©tection Session Rapide</strong> : V√©rification localStorage au d√©marrage</li>
            <li><strong>Timeouts Optimis√©s</strong> : R√©duction des d√©lais de 5s ‚Üí 2s</li>
            <li><strong>Gestion d'Erreur</strong> : Meilleure gestion des sessions expir√©es</li>
        </ul>
    </div>

    <div class="step warning">
        <h3>üîç Proc√©dure de Test</h3>
        <ol>
            <li><strong>Ouvrir l'application</strong> : <a href="http://localhost:3000" target="_blank" class="button">Ouvrir App</a></li>
            <li><strong>Observer</strong> : Y a-t-il encore une page de chargement infini au d√©marrage ?</li>
            <li><strong>Se connecter</strong> : Utiliser le bouton "Forcer la connexion" si n√©cessaire</li>
            <li><strong>V√©rifier la console</strong> : Messages "Multiple GoTrueClient" r√©duits ?</li>
            <li><strong>Test changement onglet</strong> :
                <ul>
                    <li>Une fois connect√© sur le dashboard</li>
                    <li>Changer d'onglet pendant 5-10 secondes</li>
                    <li>Revenir sur l'onglet de l'app</li>
                    <li>Observer : Page de chargement infini ? D√©connexion ?</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="step">
        <h3>üîß Debug Console</h3>
        <p>Commandes √† tester dans la console (F12) :</p>
        <div class="code">localStorage.getItem('supabase.auth.token.local.3000')</div>
        <div class="code">sessionStorage.getItem('effizen_auth_cache')</div>
        <div class="code">window.__effizen_supabase_client__ // Doit exister</div>
        <div class="code">window.globalCheckInProgress // Doit √™tre false</div>
    </div>

    <div class="step error">
        <h3>üö® Si le Probl√®me Persiste</h3>
        <ul>
            <li><strong>Vider le cache</strong> : Ctrl+Shift+R (Chrome) ou Ctrl+Shift+Delete</li>
            <li><strong>V√©rifier la console</strong> : Copier tous les messages d'erreur</li>
            <li><strong>Tester en navigation priv√©e</strong> : √âliminer les donn√©es corrompues</li>
            <li><strong>Red√©marrer le serveur</strong> : npm run dev</li>
        </ul>
    </div>

    <div class="step success">
        <h3>‚úÖ R√©sultat Attendu</h3>
        <ul>
            <li>Pas de page de chargement infini au d√©marrage</li>
            <li>Session persistante lors du changement d'onglet</li>
            <li>Messages "Multiple GoTrueClient" r√©duits (acceptable au premier chargement)</li>
            <li>Application stable et responsive</li>
        </ul>
    </div>

    <script>
        // Automatiser quelques v√©rifications
        console.log('üîç Test Page - V√©rifications automatiques:');
        console.log('- Singleton Supabase:', !!window.__effizen_supabase_client__);
        console.log('- LocalStorage session:', !!localStorage.getItem('supabase.auth.token.local.3000'));
        console.log('- SessionStorage cache:', !!sessionStorage.getItem('effizen_auth_cache'));
        
        // Fonction pour tester la visibilit√©
        window.testVisibilityChange = function() {
            console.log('üß™ Test visibilityChange manuel...');
            document.dispatchEvent(new Event('visibilitychange'));
            console.log('‚úì √âv√©nement visibilitychange d√©clench√©');
        };
        
        console.log('üí° Utilisez testVisibilityChange() pour tester manuellement');
    </script>
</body>
</html>